---
typora-root-url: img
---

## 第一章 Linux环境和相关工具

> 二进制逆向工程的通用软件IDA Pro

### 1.1 LInux工具

#### 1.1.1 GDB
> GDB 不仅可以用来调试有BUG的应用程序，也可以用于研究甚至改变一个程序的控制流，还可以用于修改代码、寄存器和数据结构。主要用于分析ELF文件和Linux进程。

#### 1.1.2 GNU binutils中的objdump

> 一种对代码进行快速反编译的方式。起缺点是需要依赖ELF文件头，并且不会进行控制流分析。

- 查看ELF文件中的所有节的数据或代码

  ==objdump -D  <elf file>==

- 只查看ELF文件中的程序代码

  ==objdump -d  <elf file>==

- 查看所有符号

  ==objdump -tT <elf file>==

#### 1.1.3 GNU binutils中的objcopy

> 可以用来分析和修改任意类型的ELF目标文件，还可以修改ELF节，或将ELF节复制到ELF二进制中。

###### **要将.data 节从一个eldf目标文件复制到另一个elf文件中，可以使用下面**

==objcopy -only-section=.data <infile> <outfile>==

#### 1.1.4 strace

> 系统调用追踪

- 使用strace 命令来跟踪一个基本的程序：

 ==strace  /bin/ls -o ls.out==

- 使用strace 命令附加到一个现存的进程上，查看log

 ==strace -p <pid> -o demon.out==  

- 原始输出将会显示每个系统调用的文件描述符编号，系统调用会将文件描述符作为参数

  SY_read(3,buf,sizeof(buf))

  如果想看读入到文件描述符3中的所有数据，可以运行下面的命令

  ==strace -e read=3 /bin/ls==

  ==strace -e write=fd /bin/ls==

#### 1.1.5 ltrace

> 库追踪，它会分析共享库，即一个程序的链接信息，并打印出用到的库函数

#### 1.1.6 基本的ltrace命令
> 除了可以查看库函数调用之外，还可以使用-S 标记查看系统调用。ltrace命令通过解析可执行文件的动态段，并打印出共享库和静态库的实际符号和函数，来提供更细粒度的信息

   ==ltrace <program> -o program.out  //针对运行的程序

![微信图片_20180717223634](E:\mybook\binery\img\微信图片_20180717223634.png)

#### 1.1.7 ftrace

> 作者自己写的 在https://github.com/elfmaster/ftrace

#### 1.1.8readelf

> 在进行反编译之前，需要收集目标文件相关的信息，该命令能够提供收集信息所需要的特定于elf的所有数据。

- 查询节表头

  readelf -S <object>

- 查询程序头表

  readelf -l <object>

- 查询符号表

  readelf -s <object>

- 查询ELF文件头数据

  readelf -n <object>

- 查询重定位入口

  readelf -r <object>

- 查询动态段

  readelf -d <object>



#### 1.1.9 ERESI-ELF反编译系统的接口

> (http://www.eresi-project.org) 中含有许多linux二进制工具                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

### 1.2 有用的设备和文件

> /proc入口对于黑客是很有用的

#### 1.2.1 /proc/<pid>/maps

> 这个文件保存了一个进程镜像的布局，通过展现每个内存映射来实现，展现的内容包括可执行文件，共享库、栈、堆和VDSO等。

![微信图片_20180717223653](/微信图片_20180717223653.png)

![微信图片_20180717223718](/微信图片_20180717223718.png)

#### 1.2.2 /proc/kcore

> 内核的动态核心文件
>
> GDB可以使用/proc/kcore来对内核进行调试和分析。

#### 1.2.3 /boot/System.map

> 包含了整个内核的所有符号

![微信图片_20180717223750](/微信图片_20180717223750.png)

#### 1.2.4 /proc/kallsyms

> 和System.map类似，其可以动态更新，如果动态安装内核模块，符号会自动添加到/proc/kallsyms中

#### 1.2.5 /proc/iomem

> 与/proc/<pid>/maps类似，不过他是跟系统内存相关的。例如想知道内核的text段所映射的物理内存位置，可以搜索kernel字符串，然后可以查看code/text段 、data段和bss段的相关内容

![微信图片_20180717223550](/微信图片_20180717223550.png)

#### 1.2.6 ECFS

> (extened core file snapshot) 扩展核心文件快照 是一项特殊的核心转储技术，专门为进程镜像的高级取证分析所设计。

### 1.3 链接器相关环境指针

> 动态加载器/链接器以及链接的概念，在程序链接、执行的过程中都是避不开的基本组成部分。需要特别理解：链接、重定向、动态加载的过程

#### 1.3.1 LD_PRELOAD环境变量

> 可以设置成一个指定库的路径，动态链接时候可以比其他的库有更高的优先级。这就允许预加载苦衷的函数和符号能够覆盖掉后续链接的库中的函数和符号。这在本质上就允许你通过重定向共享库函数来进行运行时修复。

#### 1.3.2 LD_SHOW_AUXV环境变量

> 这个环境变量可以通知程序加载器来展示程序运行时的辅助向量。辅助向量是放在程序栈上的信息。例如：想要获取进程镜像VDSO页的内存地址（也可以通过maps文件获取），就需要查询AT_SYSINFO

![微信图片_20180717225605](/微信图片_20180717225605.png)



#### 1.3.3 链接器脚本

> 链接器脚本是由链接器解释的，把程序划分为相应的节、内存和符号。默认链接器脚本可以使用
>
> ==ld -verbose==   查看 版本和具体内容

![微信图片_20180717230233](/微信图片_20180717230233.png)



gcc  可以通过 -T 标志来指定链接脚本

## 第二章 二进制格式
## 第三章 Linux进程追踪
## 第四章 ELF病毒技术-Linux/UNIX病毒
## 第五章 Linux 二进制保护
## 第六章 Linux下的ELF二进制取证分析
## 第七章 进程内存取证分析
## 第八章 ECFS --扩展核心文件快照技术
## 第九章 Linux/proc/kcore分析





